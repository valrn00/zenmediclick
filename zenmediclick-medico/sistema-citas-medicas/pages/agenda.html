<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda MÃ©dica - Sistema de Citas MÃ©dicas</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/wireframes.css">
</head>
<body>
    <div class="header">
        <div class="user-info">
            <span>Bienvenido, Dr. <span id="currentUser">MÃ©dico</span></span>
            <button class="btn btn-logout" onclick="logout()">Cerrar SesiÃ³n</button>
        </div>
    </div>

    <div class="container">
        <div class="wireframe active">
            <div class="wireframe-title">Agenda del MÃ©dico</div>
            <div class="screen">
                <div class="title-bar">Agendar del medico</div>
                
                <div class="date-section">
                    <label for="dateSearch">Fecha:</label>
                    <input type="date" id="dateSearch" value="">
                    <button class="btn" onclick="searchByDate()">Buscar</button>
                    <button class="btn" onclick="loadToday()">Hoy</button>
                </div>
                
                <div class="appointments-info">
                    <p>Fecha seleccionada: <span id="selectedDate">25/06/2025</span></p>
                    <p>Total de citas: <span id="totalAppointments">3</span></p>
                </div>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Paciente</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="appointmentTable">
                        <!-- Las citas se cargarÃ¡n dinÃ¡micamente -->
                    </tbody>
                </table>
                
                <div class="button-row">
                    <button class="btn" onclick="showDetails()" id="detailsBtn" disabled>Ver detalles</button>
                    <button class="btn" onclick="showObservations()" id="observationsBtn" disabled>Registrar observaciones</button>
                    <button class="btn btn-primary" onclick="addNewAppointment()">Nueva Cita</button>
                </div>
            </div>
            
            <div class="zen-text">Z E N</div>
            <div class="logo">ðŸª·</div>
            <div class="zen-text-bottom">M E D I C L I C K</div>
        </div>
    </div>

    <div class="navigation-links">
        <a href="../index.html" class="btn">Wireframes Completos</a>
        <a href="detalles.html" class="btn" id="detailsLink" style="display: none;">Ver Detalles</a>
        <a href="observaciones.html" class="btn" id="observationsLink" style="display: none;">Observaciones</a>
    </div>

    <script>
        // Datos de citas mÃ©dicas
        let appointments = [
            {
                id: 1,
                time: "8:00 AM",
                patient: "NicolÃ¡s SÃ¡nchez",
                status: "Confirmada",
                date: "25/06/2025",
                reason: "Dolor de cabeza",
                phone: "555-0123",
                email: "nicolas.sanchez@email.com"
            },
            {
                id: 2,
                time: "9:00 AM",
                patient: "Andrea Rodriguez",
                status: "Pendiente",
                date: "25/06/2025",
                reason: "Control rutinario",
                phone: "555-0124",
                email: "andrea.rodriguez@email.com"
            },
            {
                id: 3,
                time: "10:00 AM",
                patient: "Susy PÃ©rez",
                status: "Cancelar",
                date: "25/06/2025",
                reason: "Consulta general",
                phone: "555-0125",
                email: "susy.perez@email.com"
            }
        ];

        let selectedAppointment = null;

        // Verificar autenticaciÃ³n
        function checkAuth() {
            if (sessionStorage.getItem('userLoggedIn') !== 'true') {
                alert('Debe iniciar sesiÃ³n primero');
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // Cargar agenda
        function loadAppointments(filterDate = null) {
            const tableBody = document.getElementById('appointmentTable');
            tableBody.innerHTML = '';

            let filteredAppointments = appointments;
            
            if (filterDate) {
                filteredAppointments = appointments.filter(apt => 
                    apt.date === formatDate(new Date(filterDate))
                );
            }

            filteredAppointments.forEach(appointment => {
                const row = document.createElement('tr');
                row.setAttribute('data-appointment-id', appointment.id);
                
                const statusClass = getStatusClass(appointment.status);
                
                row.innerHTML = `
                    <td>${appointment.time}</td>
                    <td>${appointment.patient}</td>
                    <td><span class="status ${statusClass}">${appointment.status}</span></td>
                    <td>
                        <button class="btn-small" onclick="selectAppointment(${appointment.id})">Seleccionar</button>
                        <button class="btn-small" onclick="changeStatus(${appointment.id})">Cambiar Estado</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });

            // Actualizar informaciÃ³n
            document.getElementById('totalAppointments').textContent = filteredAppointments.length;
            
            if (filteredAppointments.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 20px;">
                        No hay citas programadas para esta fecha
                    </td>
                `;
                tableBody.appendChild(row);
            }
        }

        // Seleccionar cita
        function selectAppointment(appointmentId) {
            // Remover selecciÃ³n anterior
            const previousSelected = document.querySelector('.table tbody tr.selected');
            if (previousSelected) {
                previousSelected.classList.remove('selected');
            }

            // Seleccionar nueva cita
            const row = document.querySelector(`tr[data-appointment-id="${appointmentId}"]`);
            if (row) {
                row.classList.add('selected');
            }

            // Obtener datos de la cita
            selectedAppointment = appointments.find(apt => apt.id === appointmentId);
            
            if (selectedAppointment) {
                // Guardar en sessionStorage para otras pÃ¡ginas
                sessionStorage.setItem('selectedAppointment', JSON.stringify(selectedAppointment));
                
                // Habilitar botones
                document.getElementById('detailsBtn').disabled = false;
                document.getElementById('observationsBtn').disabled = false;
                document.getElementById('detailsLink').style.display = 'inline-block';
                document.getElementById('observationsLink').style.display = 'inline-block';
                
                showMessage(`Cita seleccionada: ${selectedAppointment.patient}`, 'success');
            }
        }

        // Buscar por fecha
        function searchByDate() {
            const dateInput = document.getElementById('dateSearch');
            const selectedDate = dateInput.value;
            
            if (!selectedDate) {
                showMessage('Por favor seleccione una fecha', 'error');
                return;
            }
            
            document.getElementById('selectedDate').textContent = formatDate(new Date(selectedDate));
            loadAppointments(selectedDate);
            showMessage(`Mostrando citas para ${formatDate(new Date(selectedDate))}`, 'info');
        }

        // Cargar fecha de hoy
        function loadToday() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            
            document.getElementById('dateSearch').value = todayString;
            document.getElementById('selectedDate').textContent = formatDate(today);
            
            loadAppointments(todayString);
            showMessage('Mostrando citas de hoy', 'info');
        }

        // Mostrar detalles
        function showDetails() {
            if (!selectedAppointment) {
                showMessage('Debe seleccionar una cita primero', 'error');
                return;
            }
            window.location.href = 'detalles.html';
        }

        // Mostrar observaciones
        function showObservations() {
            if (!selectedAppointment) {
                showMessage('Debe seleccionar una cita primero', 'error');
                return;
            }
            window.location.href = 'observaciones.html';
        }

        // Cambiar estado de cita
        function changeStatus(appointmentId) {
            const appointment = appointments.find(apt => apt.id === appointmentId);
            if (!appointment) return;

            const newStatus = prompt(`Estado actual: ${appointment.status}\n\nNuevo estado (Confirmada/Pendiente/Cancelada):`);
            
            if (newStatus && ['Confirmada', 'Pendiente', 'Cancelada'].includes(newStatus)) {
                appointment.status = newStatus;
                loadAppointments();
                showMessage(`Estado actualizado a: ${newStatus}`, 'success');
            } else if (newStatus !== null) {
                showMessage('Estado no vÃ¡lido', 'error');
            }
        }

        // Agregar nueva cita
        function addNewAppointment() {
            const patient = prompt('Nombre del paciente:');
            if (!patient) return;

            const time = prompt('Hora (ej: 11:00 AM):');
            if (!time) return;

            const reason = prompt('Motivo de la consulta:');
            if (!reason) return;

            const newAppointment = {
                id: appointments.length + 1,
                time: time,
                patient: patient,
                status: 'Pendiente',
                date: document.getElementById('selectedDate').textContent,
                reason: reason,
                phone: 'Por definir',
                email: 'Por definir'
            };

            appointments.push(newAppointment);
            loadAppointments();
            showMessage(`Cita agregada para ${patient}`, 'success');
        }

        // Cerrar sesiÃ³n
        function logout() {
            if (confirm('Â¿EstÃ¡ seguro de que desea cerrar sesiÃ³n?')) {
                sessionStorage.removeItem('userLoggedIn');
                sessionStorage.removeItem('currentUser');
                sessionStorage.removeItem('selectedAppointment');
                window.location.href = 'login.html';
            }
        }

        // Funciones auxiliares
        function formatDate(date) {
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function getStatusClass(status) {
            switch (status.toLowerCase()) {
                case 'confirmada': return 'status-confirmed';
                case 'pendiente': return 'status-pending';
                case 'cancelada':
                case 'cancelar': return 'status-cancelled';
                default: return '';
            }
        }

        function showMessage(message, type) {
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 5px;
                z-index: 1000;
                font-weight: bold;
                min-width: 250px;
                text-align: center;
                animation: slideInRight 0.3s ease;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;

            switch (type) {
                case 'success':
                    messageDiv.style.background = '#d4edda';
                    messageDiv.style.color = '#155724';
                    messageDiv.style.border = '1px solid #c3e6cb';
                    break;
                case 'error':
                    messageDiv.style.background = '#f8d7da';
                    messageDiv.style.color = '#721c24';
                    messageDiv.style.border = '1px solid #f5c6cb';
                    break;
                case 'info':
                    messageDiv.style.background = '#cce7ff';
                    messageDiv.style.color = '#004085';
                    messageDiv.style.border = '1px solid #99d5ff';
                    break;
            }

            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.style.animation = 'slideOutRight 0.3s ease forwards';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }

        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth()) return;

            // Configurar usuario actual
            const currentUser = sessionStorage.getItem('currentUser') || 'MÃ©dico';
            document.getElementById('currentUser').textContent = currentUser;

            // Configurar fecha actual
            loadToday();

            // Cargar cita seleccionada si existe
            const savedSelection = sessionStorage.getItem('selectedAppointment');
            if (savedSelection) {
                selectedAppointment = JSON.parse(savedSelection);
                setTimeout(() => {
                    selectAppointment(selectedAppointment.id);
                }, 500);
            }
        });

        // Estilos adicionales
        const additionalStyles = document.createElement('style');
        additionalStyles.textContent = `
            .header {
                background: white;
                padding: 15px 20px;
                margin-bottom: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .user-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .btn-logout {
                background: #dc3545;
                color: white;
                border-color: #dc3545;
            }

            .btn-logout:hover {
                background: #c82333;
                border-color: #c82333;
            }

            .appointments-info {
                background: #f8f9fa;
                padding: 10px;
                margin-bottom: 15px;
                border-radius: 5px;
                border: 1px solid #dee2e6;
            }

            .appointments-info p {
                margin: 5px 0;
                font-size: 14px;
            }

            .table th:last-child {
                width: 150px;
            }

            .btn-small {
                padding: 5px 8px;
                font-size: 11px;
                margin: 2px;
                border: 1px solid black;
                background: white;
                cursor: pointer;
                border-radius: 3px;
            }

            .btn-small:hover {
                background: #f0f0f0;
            }

            .status {
                padding: 3px 8px;
                border-radius: 12px;
                font-size: 11px;
                font-weight: bold;
            }

            .status-confirmed {
                background: #d4edda;
                color: #155724;
            }

            .status-pending {
                background: #fff3cd;
                color: #856404;
            }

            .status-cancelled {
                background: #f8d7da;
                color: #721c24;
            }

            .table tbody tr.selected {
                background: #e3f2fd;
                border: 2px solid #2196f3;
            }

            .table tbody tr:hover {
                background: #f5f5f5;
            }

            .navigation-links {
                text-align: center;
                margin-top: 30px;
            }

            .navigation-links .btn {
                margin: 0 10px;
                text-decoration: none;
                display: inline-block;
            }

            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100%);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            @keyframes slideOutRight {
                from {
                    opacity: 1;
                    transform: translateX(0);
                }
                to {
                    opacity: 0;
                    transform: translateX(100%);
                }
            }

            @media (max-width: 768px) {
                .user-info {
                    flex-direction: column;
                    gap: 10px;
                }

                .date-section {
                    flex-direction: column;
                    gap: 10px;
                }

                .table {
                    font-size: 11px;
                }

                .btn-small {
                    font-size: 9px;
                    padding: 3px 5px;
                }
            }
        `;
        document.head.appendChild(additionalStyles);
    </script>
</body>
</html>
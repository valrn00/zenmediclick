<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenMediClick - Recuperar Contraseña</title>
    <link rel="stylesheet" href="../shared/css/auth-styles.css">
</head>
<body>
    <div class="auth-container">
        <!-- Lado izquierdo - Información -->
        <div class="auth-left">
            <h1>🔑 Recuperación</h1>
            <p>Recupera el acceso a tu cuenta de forma segura</p>
            
            <ul class="features">
                <li>📧 <span>Envío de enlace por email</span></li>
                <li>🔒 <span>Proceso completamente seguro</span></li>
                <li>⏱️ <span>Enlace válido por 15 minutos</span></li>
                <li>🛡️ <span>Verificación de identidad</span></li>
            </ul>
        </div>

        <!-- Lado derecho - Formulario de recuperación -->
        <div class="auth-right">
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">🔑 Recuperar Contraseña</h2>

            <!-- Mensajes -->
            <div id="errorMessage" class="error-message"></div>
            <div id="successMessage" class="success-message"></div>

            <!-- Paso 1: Solicitar email -->
            <div id="step1" class="recovery-step active">
                <p style="color: #666; margin-bottom: 20px; text-align: center;">
                    Ingresa tu email para recibir las instrucciones de recuperación
                </p>

                <form id="recoveryForm">
                    <div class="form-group">
                        <label>Email de la cuenta</label>
                        <input type="email" id="recoveryEmail" placeholder="tu-email@ejemplo.com" required>
                    </div>

                    <button type="submit" class="btn btn-primary" id="recoveryBtn">
                        <span id="recoveryText">Enviar Instrucciones</span>
                        <div class="loading-spinner" id="recoverySpinner"></div>
                    </button>
                </form>
            </div>

            <!-- Paso 2: Confirmación de envío -->
            <div id="step2" class="recovery-step" style="display: none;">
                <div style="text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">📧</div>
                    <h3 style="color: #28a745; margin-bottom: 15px;">¡Instrucciones enviadas!</h3>
                    <p style="color: #666; margin-bottom: 20px;">
                        Hemos enviado un enlace de recuperación a <strong id="sentEmail"></strong>
                    </p>
                    <div class="security-notice">
                        <strong>⏱️ Importante:</strong> El enlace será válido por 15 minutos por motivos de seguridad.
                    </div>
                    <p style="color: #666; margin-top: 15px; font-size: 14px;">
                        ¿No ves el email? Revisa tu carpeta de spam o correo no deseado.
                    </p>
                </div>
            </div>

            <!-- Enlaces de navegación -->
            <div style="text-align: center; margin-top: 30px;">
                <a href="login.html" style="color: #4facfe; text-decoration: none; margin-right: 20px;">
                    ⬅️ Volver al login
                </a>
                <a href="register.html" style="color: #4facfe; text-decoration: none;">
                    📝 Crear cuenta nueva
                </a>
            </div>

            <!-- Información adicional -->
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #666;">
                <h4 style="color: #333; margin-bottom: 10px;">💡 Consejos de seguridad:</h4>
                <ul style="margin: 0; padding-left: 20px;">
                    <li>Nunca compartas el enlace de recuperación con nadie</li>
                    <li>El enlace solo funciona una vez</li>
                    <li>Si no solicitaste este cambio, ignora el email</li>
                    <li>Contacta soporte si tienes problemas</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/session-manager.js"></script>
    <script src="js/auth-controller.js"></script>
    
    <script>
        // Controlador de recuperación de contraseña
        const PasswordRecovery = {
            isProcessing: false,

            init() {
                document.getElementById('recoveryForm').addEventListener('submit', this.handleRecovery.bind(this));
            },

            async handleRecovery(event) {
                event.preventDefault();
                
                if (this.isProcessing) return;
                
                const email = document.getElementById('recoveryEmail').value;
                
                if (!email) {
                    this.showMessage('Por favor ingresa tu email', 'error');
                    return;
                }

                this.isProcessing = true;
                this.showLoadingState(true);

                try {
                    // Simular envío de email de recuperación
                    await this.sendRecoveryEmail(email);
                    this.showStep2(email);
                    
                } catch (error) {
                    this.showMessage(error.message, 'error');
                } finally {
                    this.showLoadingState(false);
                    this.isProcessing = false;
                }
            },

            async sendRecoveryEmail(email) {
                // Simular verificación de email en el servidor
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // Verificar si el email existe en la base de datos simulada
                        const validEmails = [
                            'paciente@ejemplo.com',
                            'medico@ejemplo.com', 
                            'admin@zenmediclick.com'
                        ];

                        if (validEmails.includes(email)) {
                            console.log(`Recovery email sent to: ${email}`);
                            resolve();
                        } else {
                            reject(new Error('Email no encontrado en nuestro sistema'));
                        }
                    }, 2000);
                });
            },

            showStep2(email) {
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';
                document.getElementById('sentEmail').textContent = email;
            },

            showLoadingState(loading) {
                const btn = document.getElementById('recoveryBtn');
                const text = document.getElementById('recoveryText');
                const spinner = document.getElementById('recoverySpinner');
                
                if (loading) {
                    btn.disabled = true;
                    text.style.opacity = '0';
                    spinner.style.display = 'block';
                } else {
                    btn.disabled = false;
                    text.style.opacity = '1';
                    spinner.style.display = 'none';
                }
            },

            showMessage(message, type) {
                const errorDiv = document.getElementById('errorMessage');
                const successDiv = document.getElementById('successMessage');
                
                errorDiv.style.display = 'none';
                successDiv.style.display = 'none';
                
                if (type === 'error') {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                } else {
                    successDiv.textContent = message;
                    successDiv.style.display = 'block';
                }
                
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                    successDiv.style.display = 'none';
                }, 5000);
            }
        };

        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            PasswordRecovery.init();
        });
    </script>
</body>
</html>